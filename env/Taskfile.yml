version: '3'

tasks:
  init:
    desc: "Initialise le fichier .env depuis .env.example"
    silent: true
    cmds:
    - |
      if [ ! -f ".env" ]; then
        if [ -f ".env.example" ]; then
          cp .env.example .env
          echo "‚úÖ Fichier .env cr√©√© depuis .env.example"
          echo "üìù Veuillez √©diter le fichier .env pour ajuster les valeurs"
        else
          echo "‚ùå Fichier .env.example non trouv√©"
          exit 1
        fi
      else
        echo "‚ÑπÔ∏è  Le fichier .env existe d√©j√†"
      fi

  validate:
    desc: "Valide la configuration du fichier .env"
    silent: true
    cmds:
    - |
      if [ ! -f ".env" ]; then
        echo "‚ùå Fichier .env non trouv√©. Ex√©cutez 'task env-init' d'abord."
        exit 1
      fi
    - echo "‚úÖ Fichier .env trouv√©"
    - |
      # V√©rification des variables critiques
      missing_vars=""
      if [ -z "{{.PROJECT_NAME}}" ]; then missing_vars="$missing_vars PROJECT_NAME"; fi
      if [ -z "{{.PROJECT_VERSION}}" ]; then missing_vars="$missing_vars PROJECT_VERSION"; fi
      if [ -z "{{.ENVIRONMENT}}" ]; then missing_vars="$missing_vars ENVIRONMENT"; fi

      if [ -n "$missing_vars" ]; then
        echo "‚ùå Variables manquantes dans .env: $missing_vars"
        exit 1
      else
        echo "‚úÖ Configuration .env valide"
      fi
