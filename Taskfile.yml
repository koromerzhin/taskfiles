version: '3'

# Taskfile principal - TÃ¢ches globales et inclusions
# Charge automatiquement les variables depuis le fichier .env s'il existe
dotenv: [ '.env' ]

includes:
  docker: ./docker/Taskfile.yml
  utils: ./utils/Taskfile.yml
  env: ./env/Taskfile.yml
  nodejs: ./nodejs/Taskfile.yml
  download: ./download/Taskfile.yml
  help: ./help/Taskfile.yml
  apache: ./apache/Taskfile.yml
  lint: ./lint/Taskfile.yml

vars:
  # Variables avec valeurs par dÃ©faut depuis .env ou valeurs de fallback
  PROJECT_NAME: '{{.PROJECT_NAME | default "taskfiles-collection"}}'
  ENVIRONMENT: '{{.ENVIRONMENT | default "development"}}'
  TIMESTAMP: '{{now | date "2006-01-02 15:04:05"}}'

tasks:
  default:
    desc: "Affiche l'aide et les tÃ¢ches disponibles"
    silent: true
    cmds:
    - echo "ğŸ› ï¸  Collection de Taskfiles pour le dÃ©veloppement"
    - echo ""
    - echo "TÃ¢ches globales disponibles :"
    - task --list
    - echo ""
    - echo "ğŸ’¡ Utilisez 'task <namespace>:<tÃ¢che>' pour accÃ©der aux tÃ¢ches spÃ©cialisÃ©es"
    - echo "ğŸ“š Utilisez 'task help:<namespace>' pour l'aide dÃ©taillÃ©e d'un namespace"

  lint:all:
    desc: "VÃ©rifie le code avec tous les outils de linting"
    silent: true
    cmds:
    - task: lint:yml

  info:
    desc: "Affiche les informations du projet avec les variables d'environnement"
    silent: true
    cmds:
    - |
      export PROJECT_VERSION=$(jq -r .version package.json)
      echo "ğŸ› ï¸  {{.PROJECT_NAME}} v$PROJECT_VERSION - Collection de Taskfiles"
      echo "ğŸ“… {{.TIMESTAMP}}"
      echo "ğŸŒ Environnement: {{.ENVIRONMENT}}"
      echo "ğŸ“‚ RÃ©pertoire: $(pwd)"
      echo ""
      echo "ğŸ“‹ Namespaces disponibles :"
      echo "  â€¢ docker   - Gestion Docker et conteneurs"
      echo "  â€¢ env      - Variables d'environnement"
      echo "  â€¢ nodejs   - Projets Node.js"
      echo "  â€¢ download - TÃ©lÃ©chargement d'outils"
      echo "  â€¢ utils    - Utilitaires divers"

  help:
    desc: "Affiche l'aide dÃ©taillÃ©e"
    silent: true
    aliases: [ h ]
    cmds:
    - task: help:default

  validate:
    desc: "Valide l'ensemble du projet"
    silent: true
    cmds:
    - echo "ğŸ” Validation du projet {{.PROJECT_NAME}}..."
    - task: env:validate
    - echo "âœ… Validation terminÃ©e avec succÃ¨s"
