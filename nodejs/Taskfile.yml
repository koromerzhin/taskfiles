version: 3
# Taskfile pour les projets Node.js

vars:
  DEV_DEPS: "all-contributors-cli cypress generate-changelog gitmoji-changelog jscpd license-checker markdownlint-cli npm-run-all readme-md-generator semantic-git-commit-cli yaml"

tasks:
  install:
    desc: "Installe les d√©pendances Node.js"
    silent: true
    preconditions:
    - sh: command -v npm
    - sh: "test -f package.json"
      msg: "Le fichier package.json est requis pour cette t√¢che"
    cmds:
    - npm install
  init:
    desc: "Initialise le projet Node.js en installant les d√©pendances"
    silent: true
    preconditions:
    - sh: command -v npm
    cmds:
    - npm init -y

  add-dev-deps:
    desc: "Ajoute les devDependencies communes si elles ne sont pas d√©j√† pr√©sentes"
    silent: true
    preconditions:
    - sh: command -v npm
      msg: "npm n'est pas install√© ou accessible"
    - sh: "test -f package.json"
      msg: "Le fichier package.json est requis pour cette t√¢che"
    cmds:
    - |
      echo "üì¶ Installation des devDependencies communes..."
      echo ""

      # Liste directe des packages
      packages="all-contributors-cli cypress generate-changelog gitmoji-changelog jscpd license-checker markdownlint-cli npm-run-all readme-md-generator semantic-git-commit-cli yaml"

      # Installation des packages
      added=0
      skipped=0

      for package_name in $packages; do
        # V√©rifie si le package est d√©j√† dans devDependencies
        if ! npm pkg get devDependencies | grep -q "\"$package_name\""; then
          echo "üì¶ Installation de $package_name..."
          if npm install --save-dev "$package_name"; then
            added=$((added + 1))
          else
            echo "‚ùå Erreur lors de l'installation de $package_name"
          fi
        else
          echo "‚è≠Ô∏è  $package_name est d√©j√† install√©, ignor√©."
          skipped=$((skipped + 1))
        fi
      done

      echo ""
      echo "üìä R√©sum√© :"
      echo "  ‚úÖ Ajout√©es: $added"
      echo "  ‚è≠Ô∏è  Ignor√©es: $skipped"
      echo "‚úÖ Installation des devDependencies termin√©e."
