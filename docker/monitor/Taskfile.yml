version: '3'

vars:
  IMAGE_NAME: '{{.IMAGE_NAME | default ""}}'

tasks:
  monitor:container:start:
    desc: "Surveille le lancement de conteneurs en temps rÃ©el"
    silent: true
    preconditions:
    - sh: command -v docker
      msg: "Docker n'est pas installÃ© ou accessible"
    summary: |
      Surveille les Ã©vÃ©nements Docker pour dÃ©tecter le lancement de conteneurs.
      Affiche quand une image est lancÃ©e avec l'horodatage.

      Variables:
      - IMAGE_NAME: Filtrer par nom d'image spÃ©cifique (optionnel)

      Exemples:
      task docker:monitor:container:start
      task docker:monitor:container:start IMAGE_NAME=nginx
    cmds:
    - |
      echo "ğŸ” Surveillance des lancements de conteneurs en temps rÃ©el..."
      echo "   Appuyez sur Ctrl+C pour arrÃªter"
      echo ""

      if [ -n "{{.IMAGE_NAME}}" ]; then
        echo "ğŸ¯ Filtrage pour l'image: {{.IMAGE_NAME}}"
        docker events --filter container --filter event=start --filter image={{.IMAGE_NAME}} --format "{{{{.TimeNano}}}} - ğŸš€ Container {{{{.Actor.Attributes.name}}}} ({{{{.Actor.Attributes.image}}}}) started"
      else
        docker events --filter container --filter event=start --format "{{{{.TimeNano}}}} - ğŸš€ Container {{{{.Actor.Attributes.name}}}} ({{{{.Actor.Attributes.image}}}}) started"
      fi

  monitor:events:
    desc: "Surveille tous les Ã©vÃ©nements Docker"
    silent: true
    preconditions:
    - sh: command -v docker
      msg: "Docker n'est pas installÃ© ou accessible"
    summary: |
      Affiche tous les Ã©vÃ©nements Docker en temps rÃ©el (start, stop, create, destroy, etc.).

      Variables:
      - IMAGE_NAME: Filtrer par image (optionnel)
      - EVENT_TYPE: Type d'Ã©vÃ©nement (start, stop, create, destroy, etc.)

      Exemples:
      task docker:monitor:events
      task docker:monitor:events EVENT_TYPE=start
      task docker:monitor:events IMAGE_NAME=nginx EVENT_TYPE=start
    cmds:
    - |
      echo "ğŸ“¡ Surveillance des Ã©vÃ©nements Docker en temps rÃ©el..."
      echo "   Appuyez sur Ctrl+C pour arrÃªter"
      echo ""

      filters="--filter container"

      if [ -n "{{.IMAGE_NAME}}" ]; then
        filters="$filters --filter image={{.IMAGE_NAME}}"
        echo "ğŸ¯ Filtrage pour l'image: {{.IMAGE_NAME}}"
      fi

      if [ -n "{{.EVENT_TYPE}}" ]; then
        filters="$filters --filter event={{.EVENT_TYPE}}"
        echo "ğŸ¯ Filtrage pour l'Ã©vÃ©nement: {{.EVENT_TYPE}}"
      fi

      echo ""
      docker events $filters --format "{{{{.Time}}}} - {{{{.Action}}}} - {{{{.Actor.Attributes.name}}}} ({{{{.Actor.Attributes.image}}}})"
