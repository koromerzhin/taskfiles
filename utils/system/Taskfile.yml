version: '3'

# Taskfile pour les informations systÃ¨me

tasks:
  info:
    desc: "Affiche les informations systÃ¨me"
    silent: true
    summary: |
      Affiche les informations dÃ©taillÃ©es du systÃ¨me et des outils installÃ©s.
    cmds:
    - |
      echo "ğŸ’» Informations systÃ¨me :"
      echo ""
      echo "ğŸ–¥ï¸  OS: $(uname -s) $(uname -r)"
      echo "ğŸ—ï¸  Architecture: $(uname -m)"
      echo "ğŸ‘¤ Utilisateur: $(whoami)"
      echo "ğŸ“‚ RÃ©pertoire: $(pwd)"
      echo "ğŸ•’ Date: $(date)"
      echo ""
      
      echo "ğŸ› ï¸  Outils disponibles :"
      for tool in docker node npm git task; do
        if command -v "$tool" >/dev/null 2>&1; then
          version=$("$tool" --version 2>/dev/null | head -n1 || echo "version inconnue")
          echo "  âœ… $tool: $version"
        else
          echo "  âŒ $tool: non installÃ©"
        fi
      done

  resources:
    desc: "Affiche l'utilisation des ressources systÃ¨me"
    silent: true
    summary: |
      Affiche l'utilisation CPU, mÃ©moire et disque.
    cmds:
    - |
      echo "ğŸ“Š Utilisation des ressources :"
      echo ""
      
      # CPU
      if command -v top >/dev/null 2>&1; then
        echo "ğŸ”¥ CPU :"
        top -l 1 -n 0 | grep "CPU usage" 2>/dev/null || \
        top -bn1 | grep "Cpu(s)" | head -n1 | awk '{print "  Utilisation: " $2}' 2>/dev/null || \
        echo "  Informations CPU non disponibles"
      fi
      
      echo ""
      
      # MÃ©moire
      echo "ğŸ’¾ MÃ©moire :"
      if command -v free >/dev/null 2>&1; then
        free -h | awk 'NR==2{printf "  UtilisÃ©e: %s/%s (%.2f%%)\n", $3,$2,$3*100/$2 }'
      elif command -v vm_stat >/dev/null 2>&1; then
        # macOS
        vm_stat | head -n 10 | grep -E "(free|active|inactive|wired)" | awk '{print "  " $0}'
      else
        echo "  Informations mÃ©moire non disponibles"
      fi
      
      echo ""
      
      # Disque
      echo "ğŸ’½ Espace disque :"
      if command -v df >/dev/null 2>&1; then
        df -h / | awk 'NR==2{printf "  Racine: %s/%s (%s utilisÃ©)\n", $3,$2,$5}'
        df -h . | awk 'NR==2{printf "  Actuel: %s/%s (%s utilisÃ©)\n", $3,$2,$5}'
      else
        echo "  Informations disque non disponibles"
      fi

  network:
    desc: "Affiche les informations rÃ©seau"
    silent: true
    summary: |
      Affiche les informations de connectivitÃ© rÃ©seau.
    cmds:
    - |
      echo "ğŸŒ Informations rÃ©seau :"
      echo ""
      
      # IP locale
      echo "ğŸ“ Adresses IP :"
      if command -v ip >/dev/null 2>&1; then
        ip addr show | grep -E "inet " | grep -v "127.0.0.1" | awk '{print "  " $2}' | head -3
      elif command -v ifconfig >/dev/null 2>&1; then
        ifconfig | grep -E "inet " | grep -v "127.0.0.1" | awk '{print "  " $2}' | head -3
      else
        echo "  Commandes rÃ©seau non disponibles"
      fi
      
      echo ""
      
      # Test de connectivitÃ©
      echo "ğŸ”— Test de connectivitÃ© :"
      if ping -c 1 8.8.8.8 >/dev/null 2>&1; then
        echo "  âœ… Internet: Accessible"
      else
        echo "  âŒ Internet: Non accessible"
      fi
      
      if ping -c 1 github.com >/dev/null 2>&1; then
        echo "  âœ… GitHub: Accessible"
      else
        echo "  âŒ GitHub: Non accessible"
      fi

  performance:
    desc: "Affiche des mÃ©triques de performance"
    silent: true
    summary: |
      Affiche des mÃ©triques de performance du systÃ¨me et du projet.
    cmds:
    - |
      echo "âš¡ MÃ©triques de performance :"
      echo ""
      
      # Uptime
      echo "â±ï¸  Temps de fonctionnement :"
      if command -v uptime >/dev/null 2>&1; then
        uptime | awk '{print "  " $0}'
      else
        echo "  Information non disponible"
      fi
      
      echo ""
      
      # Charge systÃ¨me
      echo "ğŸ“ˆ Charge systÃ¨me :"
      if [ -f /proc/loadavg ]; then
        load=$(cat /proc/loadavg | awk '{print $1, $2, $3}')
        echo "  Load average: $load"
      elif command -v sysctl >/dev/null 2>&1; then
        # macOS
        sysctl -n vm.loadavg 2>/dev/null | awk '{print "  Load average: " $2, $3, $4}' || echo "  Load average non disponible"
      else
        echo "  Load average non disponible"
      fi
      
      echo ""
      
      # Processus les plus consommateurs
      echo "ğŸ” Top processus (CPU) :"
      if command -v ps >/dev/null 2>&1; then
        ps aux --sort=-%cpu 2>/dev/null | head -6 | tail -5 | awk '{printf "  %s: %.1f%%\n", $11, $3}' || \
        ps aux | sort -rn -k3 | head -6 | tail -5 | awk '{printf "  %s: %.1f%%\n", $11, $3}' 2>/dev/null || \
        echo "  Informations processus non disponibles"
      fi

  env:
    desc: "Affiche les variables d'environnement importantes"
    silent: true
    summary: |
      Affiche les variables d'environnement importantes pour le dÃ©veloppement.
    cmds:
    - |
      echo "ğŸŒ Variables d'environnement :"
      echo ""
      
      # Variables importantes
      important_vars=(
        "PATH"
        "HOME"
        "USER"
        "SHELL"
        "EDITOR"
        "LANG"
        "NODE_ENV"
        "DOCKER_HOST"
        "PROJECT_NAME"
        "ENVIRONMENT"
      )
      
      for var in "${important_vars[@]}"; do
        value=$(printenv "$var" 2>/dev/null || echo "non dÃ©finie")
        if [ "$value" != "non dÃ©finie" ]; then
          # Tronquer les valeurs longues (comme PATH)
          if [ ${#value} -gt 80 ]; then
            short_value="${value:0:77}..."
          else
            short_value="$value"
          fi
          echo "  âœ… $var: $short_value"
        else
          echo "  âŒ $var: non dÃ©finie"
        fi
      done

  all:
    desc: "Affiche toutes les informations systÃ¨me"
    silent: true
    summary: |
      Affiche un rapport complet des informations systÃ¨me.
    cmds:
    - task: system:info
    - echo ""
    - echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    - echo ""
    - task: system:resources
    - echo ""
    - echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    - echo ""
    - task: system:network
    - echo ""
    - echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    - echo ""
    - task: system:performance
    - echo ""
    - echo "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
    - echo ""
    - task: system:env